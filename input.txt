- "Acknowledged the issue and began investigation. I reproduced the problem by trying to log in with a new Google account. Observed that the OAuth callback is returning an error code, which causes the user to be redirected back to the login page without any indication of failure. Initial suspect is a mismatch in the redirect URI, but I need to confirm by inspecting the OAuth logs.
- Reviewed the OAuth callback logs and found an error indicating that the redirect URI is incorrect for new users. Specifically, the redirect URI being passed during the OAuth flow does not match the URI registered in the Google API console. This seems to happen only for new users because existing users have a cached token, allowing them to bypass the redirect check. Will update the configuration to ensure the correct URI is passed during the OAuth flow.
- Updated the OAuth configuration to ensure that the correct redirect URI is used for both new and returning users. Modified the application code to dynamically retrieve the correct redirect URI based on the environment (development, staging, or production). Committed the changes to the staging branch and deployed the fix for testing. Will now test the login flow with new users.
- Tested the updated OAuth login flow in the staging environment. The fix resolved the redirect issue for most new accounts, but I encountered another problem where some users are receiving a '400: Invalid Request' error during login. Investigating further, I discovered that the state parameter in the OAuth request is not being handled properly, leading to a mismatch when Google redirects back to our application. I will update the state handling mechanism.
- Tested the updated OAuth login flow in the staging environment. The fix resolved the redirect issue for most new accounts, but I encountered another problem where some users are receiving a '400: Invalid Request' error during login. Investigating further, I discovered that the state parameter in the OAuth request is not being handled properly, leading to a mismatch when Google redirects back to our application. I will update the state handling mechanism.
